@model Product

@{
    ViewData["Title"] = "Додавання товару";
}

<h2 class="text-center my-3">Додавання товару</h2>

@if (TempData["Message"] != null)
{
    <div class="alert alert-info">@TempData["Message"]</div>
}

<form asp-action="AddProduct" method="post" id="addForm">
    <div class="row g-3">
        <div class="col-md-2">
            <label class="form-label">Код</label>
            <div class="input-group">
                <input asp-for="Code" class="form-control" id="codeInput" required />
                <button type="button" id="findBtn" class="btn btn-primary">Пошук</button>
            </div>
        </div>

        <div class="col-md-3">
            <label class="form-label">Назва</label>
            <input asp-for="Name" class="form-control" id="nameInput" required />
        </div>

        <div class="col-md-2">
            <label class="form-label">Кількість</label>
            <input asp-for="Quantity" class="form-control" type="number" step="0.01" id="quantityInput" required />
        </div>

        <div class="col-md-2">
            <label class="form-label">Одиниці</label>
            <select asp-for="Units" class="form-select" id="unitsInput" required>
                <option value="шт">шт</option>
                <option value="кг">кг</option>
            </select>
        </div>

        <div class="col-md-2">
            <label class="form-label">Ціна</label>
            <input asp-for="Price" class="form-control" type="number" step="0.01" id="priceInput" required />
        </div>

        <div class="col-md-1 d-flex align-items-end">
            <button type="submit" class="btn btn-success w-100">Додати</button>
        </div>
    </div>
</form>

<div id="resultMessage" class="mt-4"></div>

@section Scripts {
    <script>
        document.getElementById("findBtn").addEventListener("click", async function () {
            const code = document.getElementById("codeInput").value;
            const resultDiv = document.getElementById("resultMessage");

            if (!code) {
                resultDiv.innerHTML = `<div class="alert alert-warning">Введіть код для пошуку.</div>`;
                return;
            }

            const response = await fetch(`/Product/FindByCode?code=${code}`);
            const data = await response.json();

            if (data) {
                document.getElementById("nameInput").value = data.name;
                document.getElementById("unitsInput").value = data.units;
                document.getElementById("priceInput").value = data.price;
                document.getElementById("quantityInput").value = "";

                resultDiv.innerHTML = `<div class="alert alert-info">
                    Товар знайдено: <strong>${data.name}</strong>.<br>
                    Введіть кількість для додавання.
                </div>`;
            } else {
                document.getElementById("nameInput").value = "";
                document.getElementById("unitsInput").value = "";
                document.getElementById("priceInput").value = "";
                document.getElementById("quantityInput").value = "";

                resultDiv.innerHTML = `<div class="alert alert-success">
                    Новий товар — заповніть дані вручну.
                </div>`;
            }
        });
    </script>
}
